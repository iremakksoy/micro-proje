MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;========================
                      00002 ; main.asm
                      00003 ;========================
                      00004         LIST    P=16F877A
                      00005         #include <P16F877A.INC>
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Nov 22 2017
                      00005 ;  MPASM PIC16F877A processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2017 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      00567         LIST
                      00006         #include "common.inc"
Warning[205]: Found directive in column 1. (IFNDEF)
                      00001 IFNDEF COMMON_INC_LOADED
                      00002 COMMON_INC_LOADED   EQU     1
                      00003 
                      00004         LIST    P=16F877A
                      00005         #include <P16F877A.INC>
                      00006 
                      00007 ;------------ Config (SADECE 1 KERE) ------------
                      00008         __CONFIG _WDT_OFF & _PWRTE_ON & _CP_OFF & _LVP_OFF & _BODEN_OFF & _HS_OSC
                      00009 
                      00010 ;------------ Constants ------------
                      00011 MODE_DESIRED    EQU     0
                      00012 MODE_AMBIENT    EQU     1
                      00013 MODE_FAN        EQU     2
                      00014 
                      00015 NO_KEY          EQU     0xFF
                      00016 
                      00017 ; sys_flags bits
                      00018 F_DO_ADC        EQU     0
                      00019 F_DISP_DIRTY    EQU     1
                      00020 F_UART_GOT_FR   EQU     2
                      00021 F_UART_GOT_IN   EQU     3
                      00022 
                      00023 ; keypad entry_state
                      00024 ENT_IDLE        EQU     0
                      00025 ENT_D1          EQU     1
                      00026 ENT_D2          EQU     2
                      00027 ENT_STAR        EQU     3
                      00028 ENT_FRAC        EQU     4
                      00029 ENT_HASH        EQU     5
                      00030 
                      00031 ;------------ RAM ------------
                      00032         CBLOCK  0x20
                      00033 W_TEMP
                      00034 STATUS_TEMP
                      00035 PCLATH_TEMP
                      00036 
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00037 desired_int
                      00038 desired_frac
                      00039 ambient_int
                      00040 ambient_frac
                      00041 fan_rps
                      00042 
                      00043 tick100ms
                      00044 sec_counter
                      00045 disp_mode
                      00046 error_timer
                      00047 sys_flags
                      00048 
                      00049 disp_idx
                      00050 disp0
                      00051 disp1
                      00052 disp2
                      00053 disp3
                      00054 
                      00055 key_last
                      00056 key_ready
                      00057 key_lock
                      00058 entry_state
                      00059 in_d1
                      00060 in_d2
                      00061 in_frac
                      00062 
                      00063 uart_new_int
                      00064 uart_new_frac
                      00065 
                      00066 tmp0
                      00067 tmp1
                      00068 tmp2
                      00069 tmp3
                      00070         ENDC
                      00071 
                      00072 ENDIF
                      00007 
                      00008         ORG     0x0000
0000   2???           00009         GOTO    Init
                      00010 
Warning[205]: Found directive in column 1. (ORG)
                      00011 ORG     0x0004
0004                  00012 ISR:
0004   00A0           00013         MOVWF   W_TEMP
0005   0E03           00014         SWAPF   STATUS, W
0006   00A1           00015         MOVWF   STATUS_TEMP
0007   080A           00016         MOVF    PCLATH, W
0008   00A2           00017         MOVWF   PCLATH_TEMP
                      00018 
                      00019         ; --- FORCE BANK0 for correct SFR access (PIR1/INTCON etc.) ---
0009   1283           00020         BCF     STATUS, RP0
000A   1303           00021         BCF     STATUS, RP1
                      00022 
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00023         ; Timer1 interrupt?
000B   1283 1303      00024         BANKSEL PIR1
000D   180C           00025         BTFSC   PIR1, TMR1IF
000E   2???           00026         CALL    Temp_TMR1_ISR
                      00027 
                      00028         ; PORTB change interrupt (optional)
000F   1283 1303      00029         BANKSEL INTCON
0011   180B           00030         BTFSC   INTCON, RBIF
0012   2???           00031         CALL    Keypad_RB_ISR
                      00032 
0013   0822           00033         MOVF    PCLATH_TEMP, W
0014   008A           00034         MOVWF   PCLATH
0015   0E21           00035         SWAPF   STATUS_TEMP, W
0016   0083           00036         MOVWF   STATUS
0017   0EA0           00037         SWAPF   W_TEMP, F
0018   0E20           00038         SWAPF   W_TEMP, W
0019   0009           00039         RETFIE
                      00040 
                      00041 ;------------------------------------------------------------
001A                  00042 Init:
                      00043         ; --- Ports default ---
001A   1283 1303      00044         BANKSEL PORTA
001C   0185           00045         CLRF    PORTA
001D   0186           00046         CLRF    PORTB
001E   0187           00047         CLRF    PORTC
001F   0188           00048         CLRF    PORTD
0020   0189           00049         CLRF    PORTE
                      00050 
                      00051         ; RA0=AN0 input, RA4=T0CKI input
0021   1683 1303      00052         BANKSEL TRISA
0023   3011           00053         MOVLW   b'00010001'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0024   0085           00054         MOVWF   TRISA
                      00055 
                      00056         ; Keypad: RB7..RB4 input, RB3..RB0 output
0025   30F0           00057         MOVLW   b'11110000'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0026   0086           00058         MOVWF   TRISB
                      00059 
                      00060         ; 7seg digits on RC0..RC3 output, UART RX on RC7 input
0027   3080           00061         MOVLW   b'10000000'
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0028   0087           00062         MOVWF   TRISC
                      00063 
                      00064         ; 7seg segments on PORTD output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0029   0188           00065         CLRF    TRISD
                      00066 
                      00067         ; Heater/Cooler on RE0/RE1 output
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002A   0189           00068         CLRF    TRISE
                      00069 
                      00070         ; ADC: sadece AN0 analog, geri kalan dijital (RE0/RE1 dijital kalmal?!)
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

002B   1683 1303      00071         BANKSEL ADCON1
002D   308E           00072         MOVLW   0x8E        ; ADFM=1, PCFG=1110 -> AN0 analog, Vref=Vdd/Vss
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
002E   009F           00073         MOVWF   ADCON1
                      00074 
                      00075         ; ADC clock: FRC (simde en sorunsuz)
002F   1283 1303      00076         BANKSEL ADCON0
0031   30C1           00077         MOVLW   0xC1        ; ADCS=11 (FRC), CH0, ADON=1
0032   009F           00078         MOVWF   ADCON0
                      00079 
                      00080 
                      00081         ; OPTION_REG: enable RB pullups, TMR0 external on RA4, no prescaler
0033   1683 1303      00082         BANKSEL OPTION_REG
0035   3068           00083         MOVLW   0x68        ; RBPU=0 INTEDG=1 T0CS=1 T0SE=0 PSA=1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0036   0081           00084         MOVWF   OPTION_REG
                      00085 
                      00086         ; --- Keypad idle: columns LOW (RB0..RB3=0) + mismatch clear ---
0037   1283 1303      00087         BANKSEL PORTB
0039   0186           00088         CLRF    PORTB
003A   0806           00089         MOVF    PORTB, W            ; clear mismatch
                      00090 
                      00091         ; Timer1: internal clock, presc 1:8, enable
003B   1283 1303      00092         BANKSEL T1CON
003D   3031           00093         MOVLW   0x31
003E   0090           00094         MOVWF   T1CON
                      00095 
                      00096         ; preload TMR1 for 100ms @ Fosc=4MHz, presc=8 => 0xCF2C
003F   2???           00097         CALL    Temp_TMR1_Reload
                      00098 
                      00099         ; enable Timer1 interrupt
0040   1283 1303      00100         BANKSEL PIR1
0042   100C           00101         BCF     PIR1, TMR1IF
0043   1683 1303      00102         BANKSEL PIE1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0045   140C           00103         BSF     PIE1, TMR1IE
                      00104 
                      00105         ; keypad: we POLL in main loop -> RBIE OFF
0046   1283 1303      00106         BANKSEL INTCON
0048   100B           00107         BCF     INTCON, RBIF
0049   118B           00108         BCF     INTCON, RBIE
004A   170B           00109         BSF     INTCON, PEIE
004B   178B           00110         BSF     INTCON, GIE
                      00111 
                      00112         ; init variables
004C   1283 1303      00113         BANKSEL desired_int
004E   3019           00114         MOVLW   .25
004F   00A3           00115         MOVWF   desired_int
0050   01A4           00116         CLRF    desired_frac
                      00117 
0051   01A5           00118         CLRF    ambient_int
0052   01A6           00119         CLRF    ambient_frac
0053   01A7           00120         CLRF    fan_rps
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00121 
0054   01A8           00122         CLRF    tick100ms
0055   01A9           00123         CLRF    sec_counter
0056   01AC           00124         CLRF    sys_flags
                      00125 
0057   3000           00126         MOVLW   MODE_DESIRED
0058   00AA           00127         MOVWF   disp_mode
0059   01AD           00128         CLRF    disp_idx
005A   01AB           00129         CLRF    error_timer
                      00130 
005B   01B3           00131         CLRF    key_ready
005C   01B4           00132         CLRF    key_lock
005D   01B5           00133         CLRF    entry_state
                      00134 
                      00135         ; init modules
005E   2???           00136         CALL    Display_Rebuild
005F   2???           00137         CALL    UART_Init
0060   2???           00138         CALL    Temp_ControlUpdate
                      00139 
0061                  00140 MainLoop:
                      00141         ; display refresh (multiplex)
0061   2???           00142         CALL    Display_Service
                      00143 
                      00144         ; UART service (non-blocking)
0062   2???           00145         CALL    UART_Service
                      00146 
                      00147         ; keypad poll
0063   2???           00148         CALL    Keypad_Poll
                      00149 
                      00150         ; keypad event?
0064   1283 1303      00151         BANKSEL key_ready
0066   08B3           00152         MOVF    key_ready, F
0067   1903           00153         BTFSC   STATUS, Z
0068   2???           00154         GOTO    _no_key
0069   01B3           00155         CLRF    key_ready
006A   2???           00156         CALL    Keypad_Process
006B                  00157 _no_key:
                      00158 
                      00159         ; periodic ADC read requested?
006B   1283 1303      00160         BANKSEL sys_flags
006D   1C2C           00161         BTFSS   sys_flags, F_DO_ADC
006E   2???           00162         GOTO    _no_adc
006F   102C           00163         BCF     sys_flags, F_DO_ADC
0070   2???           00164         CALL    Temp_ReadAmbient
0071   2???           00165         CALL    Temp_ControlUpdate
0072                  00166 _no_adc:
                      00167 
                      00168         ; display dirty?
0072   1283 1303      00169         BANKSEL sys_flags
0074   1CAC           00170         BTFSS   sys_flags, F_DISP_DIRTY
0075   2???           00171         GOTO    _no_disp
0076   10AC           00172         BCF     sys_flags, F_DISP_DIRTY
0077   2???           00173         CALL    Display_Rebuild
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0078                  00174 _no_disp:
                      00175 
0078   2???           00176         GOTO    MainLoop
                      00177 
                      00178 
                      00179 
                      00180 ;========================
                      00181 ; Include code blocks
                      00182 ; (Bu dosyalar "Exclude from Build" olmal?)
                      00183 ;========================
                      00184         #include "tempctrl.asm"
                      00001 ;========================
                      00002 ; tempctrl.asm
                      00003 ;========================
                      00004         #include "common.inc"
Warning[205]: Found directive in column 1. (IFNDEF)
                      00073 IFNDEF COMMON_INC_LOADED
                      00074 COMMON_INC_LOADED   EQU     1
                      00075 
                      00076         LIST    P=16F877A
                      00077         #include <P16F877A.INC>
                      00078 
                      00079 ;------------ Config (SADECE 1 KERE) ------------
                      00080         __CONFIG _WDT_OFF & _PWRTE_ON & _CP_OFF & _LVP_OFF & _BODEN_OFF & _HS_OSC
                      00081 
                      00082 ;------------ Constants ------------
                      00083 MODE_DESIRED    EQU     0
                      00084 MODE_AMBIENT    EQU     1
                      00085 MODE_FAN        EQU     2
                      00086 
                      00087 NO_KEY          EQU     0xFF
                      00088 
                      00089 ; sys_flags bits
                      00090 F_DO_ADC        EQU     0
                      00091 F_DISP_DIRTY    EQU     1
                      00092 F_UART_GOT_FR   EQU     2
                      00093 F_UART_GOT_IN   EQU     3
                      00094 
                      00095 ; keypad entry_state
                      00096 ENT_IDLE        EQU     0
                      00097 ENT_D1          EQU     1
                      00098 ENT_D2          EQU     2
                      00099 ENT_STAR        EQU     3
                      00100 ENT_FRAC        EQU     4
                      00101 ENT_HASH        EQU     5
                      00102 
                      00103 ;------------ RAM ------------
                      00104         CBLOCK  0x20
                      00105 W_TEMP
                      00106 STATUS_TEMP
                      00107 PCLATH_TEMP
                      00108 
                      00109 desired_int
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00110 desired_frac
                      00111 ambient_int
                      00112 ambient_frac
                      00113 fan_rps
                      00114 
                      00115 tick100ms
                      00116 sec_counter
                      00117 disp_mode
                      00118 error_timer
                      00119 sys_flags
                      00120 
                      00121 disp_idx
                      00122 disp0
                      00123 disp1
                      00124 disp2
                      00125 disp3
                      00126 
                      00127 key_last
                      00128 key_ready
                      00129 key_lock
                      00130 entry_state
                      00131 in_d1
                      00132 in_d2
                      00133 in_frac
                      00134 
                      00135 uart_new_int
                      00136 uart_new_frac
                      00137 
                      00138 tmp0
                      00139 tmp1
                      00140 tmp2
                      00141 tmp3
                      00142         ENDC
                      00143 
                      00144 ENDIF
                      00005 
                      00006 ;------------------------------------------------------------
                      00007 ; Reload Timer1 for 100ms tick
                      00008 ; NOTE: This preload (0xCF2C) is correct for Fosc=4MHz, presc=1:8
                      00009 ; Timer tick = (Fosc/4)/8 = 125kHz => 8us
                      00010 ; 100ms / 8us = 12500 counts => preload = 65536-12500 = 0xCF2C
                      00011 ;------------------------------------------------------------
0079                  00012 Temp_TMR1_Reload:
0079   1283 1303      00013         BANKSEL TMR1H
007B   30CF           00014         MOVLW   0xCF
007C   008F           00015         MOVWF   TMR1H
007D   302C           00016         MOVLW   0x2C
007E   008E           00017         MOVWF   TMR1L
007F   0008           00018         RETURN
                      00019 
                      00020 ;------------------------------------------------------------
                      00021 ; Timer1 ISR: 100ms tick
                      00022 ;------------------------------------------------------------
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0080                  00023 Temp_TMR1_ISR:
0080   1283 1303      00024         BANKSEL PIR1
0082   100C           00025         BCF     PIR1, TMR1IF
0083   2???           00026         CALL    Temp_TMR1_Reload
                      00027 
0084   1283 1303      00028         BANKSEL tick100ms
0086   0AA8           00029         INCF    tick100ms, F
0087   300A           00030         MOVLW   .10
0088   0228           00031         SUBWF   tick100ms, W
0089   1D03           00032         BTFSS   STATUS, Z
008A   0008           00033         RETURN
                      00034 
                      00035         ; 1 second reached
008B   01A8           00036         CLRF    tick100ms
                      00037 
                      00038         ; fan rps = TMR0 pulses in 1s
008C   1283 1303      00039         BANKSEL TMR0
008E   0801           00040         MOVF    TMR0, W
008F   1283 1303      00041         BANKSEL fan_rps
0091   00A7           00042         MOVWF   fan_rps
0092   1283 1303      00043         BANKSEL TMR0
0094   0181           00044         CLRF    TMR0
                      00045 
                      00046         ; error timer countdown
0095   1283 1303      00047         BANKSEL error_timer
0097   08AB           00048         MOVF    error_timer, F
0098   1903           00049         BTFSC   STATUS, Z
0099   2???           00050         GOTO    _no_err_dec
009A   03AB           00051         DECF    error_timer, F
009B   1283 1303      00052         BANKSEL sys_flags
009D   14AC           00053         BSF     sys_flags, F_DISP_DIRTY
009E                  00054 _no_err_dec:
                      00055 
                      00056         ; display mode change every 2 seconds (if not showing error)
009E   1283 1303      00057         BANKSEL sec_counter
00A0   0AA9           00058         INCF    sec_counter, F
00A1   3002           00059         MOVLW   .2
00A2   0229           00060         SUBWF   sec_counter, W
00A3   1D03           00061         BTFSS   STATUS, Z
00A4   2???           00062         GOTO    _sec_done
                      00063 
00A5   01A9           00064         CLRF    sec_counter
                      00065 
                      00066         ; if error active, do not rotate
00A6   1283 1303      00067         BANKSEL error_timer
00A8   08AB           00068         MOVF    error_timer, F
00A9   1D03           00069         BTFSS   STATUS, Z
00AA   2???           00070         GOTO    _sec_done
                      00071 
00AB   1283 1303      00072         BANKSEL disp_mode
00AD   0AAA           00073         INCF    disp_mode, F
00AE   3003           00074         MOVLW   .3
00AF   022A           00075         SUBWF   disp_mode, W
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00B0   1D03           00076         BTFSS   STATUS, Z
00B1   2???           00077         GOTO    _mode_ok
00B2   01AA           00078         CLRF    disp_mode
00B3                  00079 _mode_ok:
00B3   1283 1303      00080         BANKSEL sys_flags
00B5   14AC           00081         BSF     sys_flags, F_DISP_DIRTY
                      00082 
00B6                  00083 _sec_done:
                      00084         ; request ADC update each second
00B6   1283 1303      00085         BANKSEL sys_flags
00B8   142C           00086         BSF     sys_flags, F_DO_ADC
00B9   14AC           00087         BSF     sys_flags, F_DISP_DIRTY
00BA   0008           00088         RETURN
                      00089 
                      00090 ;------------------------------------------------------------
                      00091 ; Read ambient temperature from AN0 and update ambient_int/ambient_frac
                      00092 ; LM35: 10mV/°C, ADC step ~4.887mV at 5V ref
                      00093 ; We compute temp_x10 (0.1°C units) approx: adc*4 + adc/2 + adc/4 + adc/8 + adc/128
                      00094 ;------------------------------------------------------------
00BB                  00095 Temp_ReadAmbient:
                      00096         ; acquisition delay (~ küçük bekleme)
00BB   1283 1303      00097         BANKSEL tmp0
00BD   3014           00098         MOVLW   .20
00BE   00BB           00099         MOVWF   tmp0
00BF                  00100 _acq:
00BF   0000           00101         NOP
00C0   0BBB           00102         DECFSZ  tmp0, F
00C1   2???           00103         GOTO    _acq
                      00104 
                      00105         ; start ADC
00C2   1283 1303      00106         BANKSEL ADCON0
00C4   151F           00107         BSF     ADCON0, GO_DONE
00C5                  00108 _wait_adc:
00C5   191F           00109         BTFSC   ADCON0, GO_DONE
00C6   2???           00110         GOTO    _wait_adc
                      00111 
                      00112         ; read 10-bit right-justified: ADRESH:ADRESL -> tmp1:tmp0
00C7   1683 1303      00113         BANKSEL ADRESL
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
00C9   081E           00114         MOVF    ADRESL, W
00CA   1283 1303      00115         BANKSEL tmp0
00CC   00BB           00116         MOVWF   tmp0            ; adcL
                      00117 
00CD   1283 1303      00118         BANKSEL ADRESH
00CF   081E           00119         MOVF    ADRESH, W
00D0   1283 1303      00120         BANKSEL tmp1
00D2   00BC           00121         MOVWF   tmp1            ; adcH
                      00122 
                      00123         ; accumulator tmp3:tmp2 = adc << 2  (LOGICAL shift, carry cleared each step)
00D3   1283 1303      00124         BANKSEL tmp2
00D5   083B           00125         MOVF    tmp0, W
00D6   00BD           00126         MOVWF   tmp2            ; accL
00D7   083C           00127         MOVF    tmp1, W
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00D8   00BE           00128         MOVWF   tmp3            ; accH
                      00129 
00D9   1003           00130         BCF     STATUS, C
00DA   0DBD           00131         RLF     tmp2, F
00DB   0DBE           00132         RLF     tmp3, F
00DC   1003           00133         BCF     STATUS, C
00DD   0DBD           00134         RLF     tmp2, F
00DE   0DBE           00135         RLF     tmp3, F
                      00136 
                      00137         ; scratch = adc (ambient_frac:ambient_int used as scratch pair)
00DF   1283 1303      00138         BANKSEL ambient_int
00E1   083B           00139         MOVF    tmp0, W
00E2   00A5           00140         MOVWF   ambient_int     ; scratch L
00E3   083C           00141         MOVF    tmp1, W
00E4   00A6           00142         MOVWF   ambient_frac    ; scratch H
                      00143 
                      00144         ; add adc>>1
00E5   1003           00145         BCF     STATUS, C
00E6   0CA6           00146         RRF     ambient_frac, F
00E7   0CA5           00147         RRF     ambient_int, F
00E8   2???           00148         CALL    _ADD_ACC
                      00149 
                      00150         ; add adc>>2  (shift one more, clear C!)
00E9   1003           00151         BCF     STATUS, C
00EA   0CA6           00152         RRF     ambient_frac, F
00EB   0CA5           00153         RRF     ambient_int, F
00EC   2???           00154         CALL    _ADD_ACC
                      00155 
                      00156         ; add adc>>3  (shift one more, clear C!)
00ED   1003           00157         BCF     STATUS, C
00EE   0CA6           00158         RRF     ambient_frac, F
00EF   0CA5           00159         RRF     ambient_int, F
00F0   2???           00160         CALL    _ADD_ACC
                      00161 
                      00162         ; add adc>>7 (rebuild scratch=adc then shift 7 times logically)
00F1   1283 1303      00163         BANKSEL ambient_int
00F3   083B           00164         MOVF    tmp0, W
00F4   00A5           00165         MOVWF   ambient_int
00F5   083C           00166         MOVF    tmp1, W
00F6   00A6           00167         MOVWF   ambient_frac
                      00168 
00F7   3007           00169         MOVLW   .7
00F8   1283 1303      00170         BANKSEL tmp0
00FA   00BB           00171         MOVWF   tmp0
00FB                  00172 _sh7:
00FB   1003           00173         BCF     STATUS, C
00FC   1283 1303      00174         BANKSEL ambient_int
00FE   0CA6           00175         RRF     ambient_frac, F
00FF   0CA5           00176         RRF     ambient_int, F
0100   1283 1303      00177         BANKSEL tmp0
0102   0BBB           00178         DECFSZ  tmp0, F
0103   2???           00179         GOTO    _sh7
0104   2???           00180         CALL    _ADD_ACC
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00181 
                      00182         ; Now tmp3:tmp2 = temp_x10 (0.1°C units) approx
                      00183 
                      00184         ; Divide by 10 => ambient_int (quotient), ambient_frac (remainder)
                      00185         ; quotient in tmp1, remainder in tmp2
0105   1283 1303      00186         BANKSEL tmp1
0107   01BC           00187         CLRF    tmp1         ; quotient
0108                  00188 _div10:
                      00189         ; if tmp3:tmp2 < 10 stop
0108   1283 1303      00190         BANKSEL tmp3
010A   083E           00191         MOVF    tmp3, W
010B   1D03           00192         BTFSS   STATUS, Z
010C   2???           00193         GOTO    _ge10
010D   300A           00194         MOVLW   .10
010E   1283 1303      00195         BANKSEL tmp2
0110   023D           00196         SUBWF   tmp2, W
0111   1C03           00197         BTFSS   STATUS, C
0112   2???           00198         GOTO    _div_done
0113                  00199 _ge10:
                      00200         ; subtract 10 from tmp3:tmp2
0113   300A           00201         MOVLW   .10
0114   1283 1303      00202         BANKSEL tmp2
0116   02BD           00203         SUBWF   tmp2, F
0117   1C03           00204         BTFSS   STATUS, C
0118   1283 1303      00205         BANKSEL tmp3
011A   1C03           00206         BTFSS   STATUS, C
011B   03BE           00207         DECF    tmp3, F
011C   1283 1303      00208         BANKSEL tmp1
011E   0ABC           00209         INCF    tmp1, F
011F   2???           00210         GOTO    _div10
                      00211 
0120                  00212 _div_done:
0120   1283 1303      00213         BANKSEL ambient_int
0122   083C           00214         MOVF    tmp1, W
0123   00A5           00215         MOVWF   ambient_int
0124   1283 1303      00216         BANKSEL tmp2
0126   083D           00217         MOVF    tmp2, W
0127   1283 1303      00218         BANKSEL ambient_frac
0129   00A6           00219         MOVWF   ambient_frac
                      00220 
012A   1283 1303      00221         BANKSEL sys_flags
012C   14AC           00222         BSF     sys_flags, F_DISP_DIRTY
012D   0008           00223         RETURN
                      00224 
                      00225 ; helper: acc(tmp3:tmp2) += scratch(ambient_frac:ambient_int)
012E                  00226 _ADD_ACC:
012E   1283 1303      00227         BANKSEL ambient_int
0130   0825           00228         MOVF    ambient_int, W
0131   1283 1303      00229         BANKSEL tmp2
0133   07BD           00230         ADDWF   tmp2, F
0134   1803           00231         BTFSC   STATUS, C
0135   0ABE           00232         INCF    tmp3, F
0136   1283 1303      00233         BANKSEL ambient_frac
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0138   0826           00234         MOVF    ambient_frac, W
0139   1283 1303      00235         BANKSEL tmp3
013B   07BE           00236         ADDWF   tmp3, F
013C   0008           00237         RETURN
                      00238 
                      00239 ;------------------------------------------------------------
                      00240 ; Heater/Cooler control:
                      00241 ; If desired > ambient => heater OFF, fan ON
                      00242 ; If desired < ambient => heater ON,  fan OFF
                      00243 ;------------------------------------------------------------
013D                  00244 Temp_ControlUpdate:
                      00245         ; compare desired vs ambient using int then frac
013D   1283 1303      00246         BANKSEL desired_int
013F   0825           00247         MOVF    ambient_int, W
0140   0223           00248         SUBWF   desired_int, W     ; W = desired_int - ambient_int
0141   1D03           00249         BTFSS   STATUS, Z
0142   2???           00250         GOTO    _int_diff
                      00251 
                      00252         ; int equal -> compare frac
0143   1283 1303      00253         BANKSEL desired_frac
0145   0826           00254         MOVF    ambient_frac, W
0146   0224           00255         SUBWF   desired_frac, W
0147   1D03           00256         BTFSS   STATUS, Z
0148   2???           00257         GOTO    _frac_diff
                      00258 
                      00259         ; equal -> both off
0149   1283 1303      00260         BANKSEL PORTE
014B   1009           00261         BCF     PORTE, 0
014C   1089           00262         BCF     PORTE, 1
014D   0008           00263         RETURN
                      00264 
014E                  00265 _int_diff:
                      00266         ; if desired - ambient >= 0 => desired > ambient
014E   1C03           00267         BTFSS   STATUS, C
014F   2???           00268         GOTO    _desired_lt
0150   2???           00269         GOTO    _desired_gt
                      00270 
0151                  00271 _frac_diff:
0151   1C03           00272         BTFSS   STATUS, C
0152   2???           00273         GOTO    _desired_lt
0153   2???           00274         GOTO    _desired_gt
                      00275 
0154                  00276 _desired_gt:
                      00277         ; desired > ambient -> HEATER ON, COOLER OFF
0154   1283 1303      00278         BANKSEL PORTE
0156   1409           00279         BSF     PORTE, 0
0157   1089           00280         BCF     PORTE, 1
0158   0008           00281         RETURN
                      00282 
0159                  00283 _desired_lt:
                      00284         ; desired < ambient -> HEATER OFF, COOLER ON
0159   1283 1303      00285         BANKSEL PORTE
015B   1009           00286         BCF     PORTE, 0
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

015C   1489           00287         BSF     PORTE, 1
015D   0008           00288         RETURN
                      00289 
                      00185         #include "keypad.asm"
                      00001 ;========================
                      00002 ; keypad.asm (REWRITE - stable)
                      00003 ; PIC16F877A - 4x4 keypad
                      00004 ; Rows: RB4..RB7 (inputs with pull-ups)
                      00005 ; Cols: RB0..RB3 (outputs)
                      00006 ; Layout:
                      00007 ;   1 2 3 A
                      00008 ;   4 5 6 B
                      00009 ;   7 8 9 C
                      00010 ;   * 0 # D
                      00011 ;
                      00012 ; Entry format:  A  X  X  *  X  #
                      00013 ; Valid range: 10.0 .. 50.0   (50.x INVALID)
                      00014 ; Invalid -> error_timer -> Display "EROR"
                      00015 ;========================
                      00016         #include "common.inc"
Warning[205]: Found directive in column 1. (IFNDEF)
                      00145 IFNDEF COMMON_INC_LOADED
                      00146 COMMON_INC_LOADED   EQU     1
                      00147 
                      00148         LIST    P=16F877A
                      00149         #include <P16F877A.INC>
                      00150 
                      00151 ;------------ Config (SADECE 1 KERE) ------------
                      00152         __CONFIG _WDT_OFF & _PWRTE_ON & _CP_OFF & _LVP_OFF & _BODEN_OFF & _HS_OSC
                      00153 
                      00154 ;------------ Constants ------------
                      00155 MODE_DESIRED    EQU     0
                      00156 MODE_AMBIENT    EQU     1
                      00157 MODE_FAN        EQU     2
                      00158 
                      00159 NO_KEY          EQU     0xFF
                      00160 
                      00161 ; sys_flags bits
                      00162 F_DO_ADC        EQU     0
                      00163 F_DISP_DIRTY    EQU     1
                      00164 F_UART_GOT_FR   EQU     2
                      00165 F_UART_GOT_IN   EQU     3
                      00166 
                      00167 ; keypad entry_state
                      00168 ENT_IDLE        EQU     0
                      00169 ENT_D1          EQU     1
                      00170 ENT_D2          EQU     2
                      00171 ENT_STAR        EQU     3
                      00172 ENT_FRAC        EQU     4
                      00173 ENT_HASH        EQU     5
                      00174 
                      00175 ;------------ RAM ------------
                      00176         CBLOCK  0x20
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00177 W_TEMP
                      00178 STATUS_TEMP
                      00179 PCLATH_TEMP
                      00180 
                      00181 desired_int
                      00182 desired_frac
                      00183 ambient_int
                      00184 ambient_frac
                      00185 fan_rps
                      00186 
                      00187 tick100ms
                      00188 sec_counter
                      00189 disp_mode
                      00190 error_timer
                      00191 sys_flags
                      00192 
                      00193 disp_idx
                      00194 disp0
                      00195 disp1
                      00196 disp2
                      00197 disp3
                      00198 
                      00199 key_last
                      00200 key_ready
                      00201 key_lock
                      00202 entry_state
                      00203 in_d1
                      00204 in_d2
                      00205 in_frac
                      00206 
                      00207 uart_new_int
                      00208 uart_new_frac
                      00209 
                      00210 tmp0
                      00211 tmp1
                      00212 tmp2
                      00213 tmp3
                      00214         ENDC
                      00215 
                      00216 ENDIF
                      00017 
                      00018 ;------------------------------------------------------------
                      00019 ; Optional RB-change ISR handler
                      00020 ; (RBIE kapal?ysa zaten ça?r?lmaz, sorun de?il)
                      00021 ;------------------------------------------------------------
015E                  00022 Keypad_RB_ISR:
015E   1283 1303      00023         BANKSEL PORTB
0160   0806           00024         MOVF    PORTB, W          ; clear mismatch
0161   1283 1303      00025         BANKSEL INTCON
0163   100B           00026         BCF     INTCON, RBIF
0164   0008           00027         RETURN
                      00028 
                      00029 ;------------------------------------------------------------
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00030 ; Keypad_Poll (call every MainLoop)
                      00031 ; Debounce: one key per press (key_lock)
                      00032 ;------------------------------------------------------------
0165                  00033 Keypad_Poll:
                      00034         ; if a key is already pending, do nothing
0165   1283 1303      00035         BANKSEL key_ready
0167   08B3           00036         MOVF    key_ready, F
0168   1D03           00037         BTFSS   STATUS, Z
0169   0008           00038         RETURN
                      00039 
016A   2???           00040         CALL    Keypad_Scan        ; W = ASCII or NO_KEY
016B   1283 1303      00041         BANKSEL tmp0
016D   00BB           00042         MOVWF   tmp0
                      00043 
                      00044         ; NO_KEY ?
016E   083B           00045         MOVF    tmp0, W
016F   3AFF           00046         XORLW   NO_KEY
0170   1903           00047         BTFSC   STATUS, Z
0171   2???           00048         GOTO    _kp_rel
                      00049 
                      00050         ; pressed -> if locked ignore
0172   1283 1303      00051         BANKSEL key_lock
0174   08B4           00052         MOVF    key_lock, F
0175   1D03           00053         BTFSS   STATUS, Z
0176   0008           00054         RETURN
                      00055 
                      00056         ; accept new key
0177   3001           00057         MOVLW   0x01
0178   00B4           00058         MOVWF   key_lock
                      00059 
0179   1283 1303      00060         BANKSEL key_last
017B   083B           00061         MOVF    tmp0, W
017C   00B2           00062         MOVWF   key_last
                      00063 
017D   1283 1303      00064         BANKSEL key_ready
017F   3001           00065         MOVLW   0x01
0180   00B3           00066         MOVWF   key_ready
0181   0008           00067         RETURN
                      00068 
0182                  00069 _kp_rel:
                      00070         ; released -> unlock
0182   1283 1303      00071         BANKSEL key_lock
0184   01B4           00072         CLRF    key_lock
0185   0008           00073         RETURN
                      00074 
                      00075 ;------------------------------------------------------------
                      00076 ; Keypad_Scan
                      00077 ; Returns W = ASCII key, or NO_KEY (0xFF)
                      00078 ; Leaves idle with ALL columns LOW (RB0..RB3=0)
                      00079 ;------------------------------------------------------------
0186                  00080 Keypad_Scan:
                      00081         ; COL0 low (RB0=0, RB1..RB3=1) => 1110b = 0x0E
0186   1283 1303      00082         BANKSEL PORTB
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0188   300E           00083         MOVLW   0x0E
0189   0086           00084         MOVWF   PORTB
018A   2???           00085         CALL    _ReadRow
018B   1D03           00086         BTFSS   STATUS, Z
018C   2???           00087         GOTO    _c0
                      00088 
                      00089         ; COL1 low => 1101b = 0x0D
018D   300D           00090         MOVLW   0x0D
018E   0086           00091         MOVWF   PORTB
018F   2???           00092         CALL    _ReadRow
0190   1D03           00093         BTFSS   STATUS, Z
0191   2???           00094         GOTO    _c1
                      00095 
                      00096         ; COL2 low => 1011b = 0x0B
0192   300B           00097         MOVLW   0x0B
0193   0086           00098         MOVWF   PORTB
0194   2???           00099         CALL    _ReadRow
0195   1D03           00100         BTFSS   STATUS, Z
0196   2???           00101         GOTO    _c2
                      00102 
                      00103         ; COL3 low => 0111b = 0x07
0197   3007           00104         MOVLW   0x07
0198   0086           00105         MOVWF   PORTB
0199   2???           00106         CALL    _ReadRow
019A   1D03           00107         BTFSS   STATUS, Z
019B   2???           00108         GOTO    _c3
                      00109 
                      00110         ; none
019C   1283 1303      00111         BANKSEL PORTB
019E   0186           00112         CLRF    PORTB              ; idle = columns LOW
019F   30FF           00113         MOVLW   NO_KEY
01A0   0008           00114         RETURN
                      00115 
01A1                  00116 _c0:
01A1   083C           00117         MOVF    tmp1, W
01A2   2???           00118         CALL    _RowMul4
                      00119         ; +0
01A3   2???           00120         CALL    _KeyMap
01A4   2???           00121         GOTO    _scan_done
01A5                  00122 _c1:
01A5   083C           00123         MOVF    tmp1, W
01A6   2???           00124         CALL    _RowMul4
01A7   3E01           00125         ADDLW   .1
01A8   2???           00126         CALL    _KeyMap
01A9   2???           00127         GOTO    _scan_done
01AA                  00128 _c2:
01AA   083C           00129         MOVF    tmp1, W
01AB   2???           00130         CALL    _RowMul4
01AC   3E02           00131         ADDLW   .2
01AD   2???           00132         CALL    _KeyMap
01AE   2???           00133         GOTO    _scan_done
01AF                  00134 _c3:
01AF   083C           00135         MOVF    tmp1, W
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01B0   2???           00136         CALL    _RowMul4
01B1   3E03           00137         ADDLW   .3
01B2   2???           00138         CALL    _KeyMap
01B3   2???           00139         GOTO    _scan_done
                      00140 
01B4                  00141 _scan_done:
01B4   1283 1303      00142         BANKSEL tmp2
01B6   00BD           00143         MOVWF   tmp2               ; save ASCII
01B7   1283 1303      00144         BANKSEL PORTB
01B9   0186           00145         CLRF    PORTB              ; idle = columns LOW
01BA   1283 1303      00146         BANKSEL tmp2
01BC   083D           00147         MOVF    tmp2, W
01BD   0008           00148         RETURN
                      00149 
                      00150 ;------------------------------------------------------------
                      00151 ; _ReadRow
                      00152 ; OUT:
                      00153 ;   - NO press: returns with Z=1
                      00154 ;   - press   : tmp1 = row index (0..3), returns with Z=0
                      00155 ;------------------------------------------------------------
01BE                  00156 _ReadRow:
01BE   0000           00157         NOP
01BF   0000           00158         NOP
01C0   1283 1303      00159         BANKSEL PORTB
01C2   0806           00160         MOVF    PORTB, W
01C3   39F0           00161         ANDLW   0xF0
01C4   3AF0           00162         XORLW   0xF0
01C5   1903           00163         BTFSC   STATUS, Z
01C6   0008           00164         RETURN                    ; Z=1 (no press)
                      00165 
                      00166         ; find which row is LOW
01C7   1283 1303      00167         BANKSEL PORTB
01C9   1E06           00168         BTFSS   PORTB, 4
01CA   2???           00169         GOTO    _r0
01CB   1E86           00170         BTFSS   PORTB, 5
01CC   2???           00171         GOTO    _r1
01CD   1F06           00172         BTFSS   PORTB, 6
01CE   2???           00173         GOTO    _r2
                      00174         ; else row3
01CF   1283 1303      00175         BANKSEL tmp1
01D1   3003           00176         MOVLW   .3
01D2   00BC           00177         MOVWF   tmp1
01D3   2???           00178         GOTO    _pressed
01D4                  00179 _r0:
01D4   1283 1303      00180         BANKSEL tmp1
01D6   01BC           00181         CLRF    tmp1
01D7   2???           00182         GOTO    _pressed
01D8                  00183 _r1:
01D8   1283 1303      00184         BANKSEL tmp1
01DA   3001           00185         MOVLW   .1
01DB   00BC           00186         MOVWF   tmp1
01DC   2???           00187         GOTO    _pressed
01DD                  00188 _r2:
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01DD   1283 1303      00189         BANKSEL tmp1
01DF   3002           00190         MOVLW   .2
01E0   00BC           00191         MOVWF   tmp1
01E1                  00192 _pressed:
                      00193         ; force Z=0 before returning (W don't care)
01E1   3001           00194         MOVLW   0x01
01E2   3800           00195         IORLW   0x00
01E3   0008           00196         RETURN
                      00197 
                      00198 ; W=row -> W=row*4
01E4                  00199 _RowMul4:
01E4   1283 1303      00200         BANKSEL tmp2
01E6   00BD           00201         MOVWF   tmp2
01E7   1003           00202         BCF     STATUS, C
01E8   0DBD           00203         RLF     tmp2, F
01E9   1003           00204         BCF     STATUS, C
01EA   0DBD           00205         RLF     tmp2, F
01EB   083D           00206         MOVF    tmp2, W
01EC   0008           00207         RETURN
                      00208 
                      00209 ;------------------------------------------------------------
                      00210 ; _KeyMap (no jump-table -> PCLATH safe)
                      00211 ; IN:  W=index 0..15
                      00212 ; OUT: W=ASCII
                      00213 ;------------------------------------------------------------
01ED                  00214 _KeyMap:
01ED   1283 1303      00215         BANKSEL tmp0
01EF   00BB           00216         MOVWF   tmp0
                      00217 
01F0   3000           00218         MOVLW   .0
01F1   063B           00219         XORWF   tmp0, W
01F2   1903           00220         BTFSC   STATUS, Z
01F3   3431           00221         RETLW   '1'
01F4   3001           00222         MOVLW   .1
01F5   063B           00223         XORWF   tmp0, W
01F6   1903           00224         BTFSC   STATUS, Z
01F7   3432           00225         RETLW   '2'
01F8   3002           00226         MOVLW   .2
01F9   063B           00227         XORWF   tmp0, W
01FA   1903           00228         BTFSC   STATUS, Z
01FB   3433           00229         RETLW   '3'
01FC   3003           00230         MOVLW   .3
01FD   063B           00231         XORWF   tmp0, W
01FE   1903           00232         BTFSC   STATUS, Z
01FF   3441           00233         RETLW   'A'
                      00234 
0200   3004           00235         MOVLW   .4
0201   063B           00236         XORWF   tmp0, W
0202   1903           00237         BTFSC   STATUS, Z
0203   3434           00238         RETLW   '4'
0204   3005           00239         MOVLW   .5
0205   063B           00240         XORWF   tmp0, W
0206   1903           00241         BTFSC   STATUS, Z
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0207   3435           00242         RETLW   '5'
0208   3006           00243         MOVLW   .6
0209   063B           00244         XORWF   tmp0, W
020A   1903           00245         BTFSC   STATUS, Z
020B   3436           00246         RETLW   '6'
020C   3007           00247         MOVLW   .7
020D   063B           00248         XORWF   tmp0, W
020E   1903           00249         BTFSC   STATUS, Z
020F   3442           00250         RETLW   'B'
                      00251 
0210   3008           00252         MOVLW   .8
0211   063B           00253         XORWF   tmp0, W
0212   1903           00254         BTFSC   STATUS, Z
0213   3437           00255         RETLW   '7'
0214   3009           00256         MOVLW   .9
0215   063B           00257         XORWF   tmp0, W
0216   1903           00258         BTFSC   STATUS, Z
0217   3438           00259         RETLW   '8'
0218   300A           00260         MOVLW   .10
0219   063B           00261         XORWF   tmp0, W
021A   1903           00262         BTFSC   STATUS, Z
021B   3439           00263         RETLW   '9'
021C   300B           00264         MOVLW   .11
021D   063B           00265         XORWF   tmp0, W
021E   1903           00266         BTFSC   STATUS, Z
021F   3443           00267         RETLW   'C'
                      00268 
0220   300C           00269         MOVLW   .12
0221   063B           00270         XORWF   tmp0, W
0222   1903           00271         BTFSC   STATUS, Z
0223   342A           00272         RETLW   '*'
0224   300D           00273         MOVLW   .13
0225   063B           00274         XORWF   tmp0, W
0226   1903           00275         BTFSC   STATUS, Z
0227   3430           00276         RETLW   '0'
0228   300E           00277         MOVLW   .14
0229   063B           00278         XORWF   tmp0, W
022A   1903           00279         BTFSC   STATUS, Z
022B   3423           00280         RETLW   '#'
022C   300F           00281         MOVLW   .15
022D   063B           00282         XORWF   tmp0, W
022E   1903           00283         BTFSC   STATUS, Z
022F   3444           00284         RETLW   'D'
                      00285 
0230   34FF           00286         RETLW   NO_KEY
                      00287 
                      00288 ;------------------------------------------------------------
                      00289 ; Keypad_Process (A XX*X#)
                      00290 ;------------------------------------------------------------
0231                  00291 Keypad_Process:
0231   1283 1303      00292         BANKSEL key_last
0233   0832           00293         MOVF    key_last, W
                      00294 
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00295         ; 'A' always starts entry
0234   3A41           00296         XORLW   'A'
0235   1903           00297         BTFSC   STATUS, Z
0236   2???           00298         GOTO    _start_entry
                      00299 
                      00300         ; if idle -> ignore
0237   1283 1303      00301         BANKSEL entry_state
0239   08B5           00302         MOVF    entry_state, F
023A   1903           00303         BTFSC   STATUS, Z
023B   0008           00304         RETURN
                      00305 
                      00306         ; dispatch by entry_state
023C   0835           00307         MOVF    entry_state, W
023D   3A01           00308         XORLW   .1
023E   1903           00309         BTFSC   STATUS, Z
023F   2???           00310         GOTO    _digit1
                      00311 
0240   0835           00312         MOVF    entry_state, W
0241   3A02           00313         XORLW   .2
0242   1903           00314         BTFSC   STATUS, Z
0243   2???           00315         GOTO    _digit2
                      00316 
0244   0835           00317         MOVF    entry_state, W
0245   3A03           00318         XORLW   .3
0246   1903           00319         BTFSC   STATUS, Z
0247   2???           00320         GOTO    _expect_star
                      00321 
0248   0835           00322         MOVF    entry_state, W
0249   3A04           00323         XORLW   .4
024A   1903           00324         BTFSC   STATUS, Z
024B   2???           00325         GOTO    _frac
                      00326 
024C   0835           00327         MOVF    entry_state, W
024D   3A05           00328         XORLW   .5
024E   1903           00329         BTFSC   STATUS, Z
024F   2???           00330         GOTO    _expect_hash
                      00331 
0250   0008           00332         RETURN
                      00333 
0251                  00334 _start_entry:
0251   1283 1303      00335         BANKSEL entry_state
0253   3001           00336         MOVLW   .1
0254   00B5           00337         MOVWF   entry_state
0255   1283 1303      00338         BANKSEL in_d1
0257   01B6           00339         CLRF    in_d1
0258   01B7           00340         CLRF    in_d2
0259   01B8           00341         CLRF    in_frac
025A   0008           00342         RETURN
                      00343 
025B                  00344 _digit1:
025B   1283 1303      00345         BANKSEL key_last
025D   0832           00346         MOVF    key_last, W
025E   2???           00347         CALL    _AsciiDigitToBin
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

025F   1803           00348         BTFSC   STATUS, C
0260   0008           00349         RETURN
0261   1283 1303      00350         BANKSEL in_d1
0263   00B6           00351         MOVWF   in_d1
0264   1283 1303      00352         BANKSEL entry_state
0266   3002           00353         MOVLW   .2
0267   00B5           00354         MOVWF   entry_state
0268   0008           00355         RETURN
                      00356 
0269                  00357 _digit2:
0269   1283 1303      00358         BANKSEL key_last
026B   0832           00359         MOVF    key_last, W
026C   2???           00360         CALL    _AsciiDigitToBin
026D   1803           00361         BTFSC   STATUS, C
026E   0008           00362         RETURN
026F   1283 1303      00363         BANKSEL in_d2
0271   00B7           00364         MOVWF   in_d2
0272   1283 1303      00365         BANKSEL entry_state
0274   3003           00366         MOVLW   .3
0275   00B5           00367         MOVWF   entry_state
0276   0008           00368         RETURN
                      00369 
0277                  00370 _expect_star:
0277   1283 1303      00371         BANKSEL key_last
0279   0832           00372         MOVF    key_last, W
027A   3A2A           00373         XORLW   '*'
027B   1D03           00374         BTFSS   STATUS, Z
027C   0008           00375         RETURN
027D   1283 1303      00376         BANKSEL entry_state
027F   3004           00377         MOVLW   .4
0280   00B5           00378         MOVWF   entry_state
0281   0008           00379         RETURN
                      00380 
0282                  00381 _frac:
0282   1283 1303      00382         BANKSEL key_last
0284   0832           00383         MOVF    key_last, W
0285   2???           00384         CALL    _AsciiDigitToBin
0286   1803           00385         BTFSC   STATUS, C
0287   0008           00386         RETURN
0288   1283 1303      00387         BANKSEL in_frac
028A   00B8           00388         MOVWF   in_frac
028B   1283 1303      00389         BANKSEL entry_state
028D   3005           00390         MOVLW   .5
028E   00B5           00391         MOVWF   entry_state
028F   0008           00392         RETURN
                      00393 
0290                  00394 _expect_hash:
0290   1283 1303      00395         BANKSEL key_last
0292   0832           00396         MOVF    key_last, W
0293   3A23           00397         XORLW   '#'
0294   1D03           00398         BTFSS   STATUS, Z
0295   0008           00399         RETURN
                      00400 
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0296   2???           00401         CALL    _CommitDesiredIfValid
                      00402 
0297   1283 1303      00403         BANKSEL entry_state
0299   01B5           00404         CLRF    entry_state
029A   0008           00405         RETURN
                      00406 
                      00407 ;------------------------------------------------------------
                      00408 ; _AsciiDigitToBin
                      00409 ; IN:  W=ASCII
                      00410 ; OUT: W=0..9, C=0 ok / C=1 bad
                      00411 ;------------------------------------------------------------
029B                  00412 _AsciiDigitToBin:
029B   1283 1303      00413         BANKSEL tmp0
029D   00BB           00414         MOVWF   tmp0
                      00415 
029E   3030           00416         MOVLW   '0'
029F   023B           00417         SUBWF   tmp0, W            ; W = tmp0 - '0'
02A0   1C03           00418         BTFSS   STATUS, C
02A1   2???           00419         GOTO    _bad_digit
02A2   303A           00420         MOVLW   '9'+1
02A3   023B           00421         SUBWF   tmp0, W            ; W = tmp0 - ('9'+1)
02A4   1803           00422         BTFSC   STATUS, C
02A5   2???           00423         GOTO    _bad_digit
                      00424 
02A6   1283 1303      00425         BANKSEL tmp0
02A8   083B           00426         MOVF    tmp0, W
02A9   3ED0           00427         ADDLW   -'0'
02AA   1003           00428         BCF     STATUS, C
02AB   0008           00429         RETURN
                      00430 
02AC                  00431 _bad_digit:
02AC   1403           00432         BSF     STATUS, C
02AD   0008           00433         RETURN
                      00434 
                      00435 ;------------------------------------------------------------
                      00436 ; _CommitDesiredIfValid
                      00437 ; int = 10*in_d1 + in_d2
                      00438 ; frac = in_frac
                      00439 ; valid: 10.0 .. 50.0 (50.x invalid)
                      00440 ;------------------------------------------------------------
02AE                  00441 _CommitDesiredIfValid:
                      00442 
                      00443         ; tmp0 = 10*in_d1 + in_d2
                      00444         ; tmp0 = (in_d1*8) + (in_d1*2) + in_d2
02AE   1283 1303      00445         BANKSEL in_d1
02B0   0836           00446         MOVF    in_d1, W
02B1   00BC           00447         MOVWF   tmp1            ; tmp1 = d1
                      00448 
                      00449         ; tmp2 = d1*8
02B2   083C           00450         MOVF    tmp1, W
02B3   00BD           00451         MOVWF   tmp2
02B4   1003           00452         BCF     STATUS, C
02B5   0DBD           00453         RLF     tmp2, F         ; *2
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02B6   1003           00454         BCF     STATUS, C
02B7   0DBD           00455         RLF     tmp2, F         ; *4
02B8   1003           00456         BCF     STATUS, C
02B9   0DBD           00457         RLF     tmp2, F         ; *8
                      00458 
                      00459         ; tmp0 = d1*2
02BA   083C           00460         MOVF    tmp1, W
02BB   00BB           00461         MOVWF   tmp0
02BC   1003           00462         BCF     STATUS, C
02BD   0DBB           00463         RLF     tmp0, F         ; *2
                      00464 
                      00465         ; tmp0 = d1*10
02BE   083D           00466         MOVF    tmp2, W
02BF   07BB           00467         ADDWF   tmp0, F
                      00468 
                      00469         ; tmp0 = d1*10 + d2
02C0   1283 1303      00470         BANKSEL in_d2
02C2   0837           00471         MOVF    in_d2, W
02C3   07BB           00472         ADDWF   tmp0, F
                      00473 
                      00474         ; ----- Range checks -----
                      00475         ; int >= 10 ?
02C4   300A           00476         MOVLW   .10
02C5   023B           00477         SUBWF   tmp0, W          ; W = int - 10
02C6   1C03           00478         BTFSS   STATUS, C
02C7   2???           00479         GOTO    _kp_invalid
                      00480 
                      00481         ; int <= 50 ?  (invalid if int >= 51)
02C8   3033           00482         MOVLW   .51
02C9   023B           00483         SUBWF   tmp0, W          ; W = int - 51
02CA   1803           00484         BTFSC   STATUS, C
02CB   2???           00485         GOTO    _kp_invalid
                      00486 
                      00487         ; if int==50 then frac must be 0
02CC   083B           00488         MOVF    tmp0, W
02CD   3A32           00489         XORLW   .50
02CE   1D03           00490         BTFSS   STATUS, Z
02CF   2???           00491         GOTO    _kp_accept
02D0   1283 1303      00492         BANKSEL in_frac
02D2   08B8           00493         MOVF    in_frac, F
02D3   1D03           00494         BTFSS   STATUS, Z
02D4   2???           00495         GOTO    _kp_invalid
                      00496 
02D5                  00497 _kp_accept:
02D5   1283 1303      00498         BANKSEL desired_int
02D7   083B           00499         MOVF    tmp0, W
02D8   00A3           00500         MOVWF   desired_int
                      00501 
02D9   1283 1303      00502         BANKSEL in_frac
02DB   0838           00503         MOVF    in_frac, W
02DC   1283 1303      00504         BANKSEL desired_frac
02DE   00A4           00505         MOVWF   desired_frac
                      00506 
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00507         ; show desired immediately
02DF   1283 1303      00508         BANKSEL disp_mode
02E1   3000           00509         MOVLW   MODE_DESIRED
02E2   00AA           00510         MOVWF   disp_mode
02E3   1283 1303      00511         BANKSEL disp_idx
02E5   01AD           00512         CLRF    disp_idx
                      00513 
02E6   1283 1303      00514         BANKSEL sys_flags
02E8   14AC           00515         BSF     sys_flags, F_DISP_DIRTY
                      00516 
02E9   2???           00517         CALL    Temp_ControlUpdate
02EA   0008           00518         RETURN
                      00519 
02EB                  00520 _kp_invalid:
02EB   1283 1303      00521         BANKSEL error_timer
02ED   3002           00522         MOVLW   .2               ; 2 seconds
02EE   00AB           00523         MOVWF   error_timer
02EF   1283 1303      00524         BANKSEL sys_flags
02F1   14AC           00525         BSF     sys_flags, F_DISP_DIRTY
02F2   0008           00526         RETURN
                      00186         #include "display.asm"
                      00001 ;========================
                      00002 ; display.asm
                      00003 ;========================
                      00004         #include "common.inc"
Warning[205]: Found directive in column 1. (IFNDEF)
                      00217 IFNDEF COMMON_INC_LOADED
                      00218 COMMON_INC_LOADED   EQU     1
                      00219 
                      00220         LIST    P=16F877A
                      00221         #include <P16F877A.INC>
                      00222 
                      00223 ;------------ Config (SADECE 1 KERE) ------------
                      00224         __CONFIG _WDT_OFF & _PWRTE_ON & _CP_OFF & _LVP_OFF & _BODEN_OFF & _HS_OSC
                      00225 
                      00226 ;------------ Constants ------------
                      00227 MODE_DESIRED    EQU     0
                      00228 MODE_AMBIENT    EQU     1
                      00229 MODE_FAN        EQU     2
                      00230 
                      00231 NO_KEY          EQU     0xFF
                      00232 
                      00233 ; sys_flags bits
                      00234 F_DO_ADC        EQU     0
                      00235 F_DISP_DIRTY    EQU     1
                      00236 F_UART_GOT_FR   EQU     2
                      00237 F_UART_GOT_IN   EQU     3
                      00238 
                      00239 ; keypad entry_state
                      00240 ENT_IDLE        EQU     0
                      00241 ENT_D1          EQU     1
                      00242 ENT_D2          EQU     2
                      00243 ENT_STAR        EQU     3
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00244 ENT_FRAC        EQU     4
                      00245 ENT_HASH        EQU     5
                      00246 
                      00247 ;------------ RAM ------------
                      00248         CBLOCK  0x20
                      00249 W_TEMP
                      00250 STATUS_TEMP
                      00251 PCLATH_TEMP
                      00252 
                      00253 desired_int
                      00254 desired_frac
                      00255 ambient_int
                      00256 ambient_frac
                      00257 fan_rps
                      00258 
                      00259 tick100ms
                      00260 sec_counter
                      00261 disp_mode
                      00262 error_timer
                      00263 sys_flags
                      00264 
                      00265 disp_idx
                      00266 disp0
                      00267 disp1
                      00268 disp2
                      00269 disp3
                      00270 
                      00271 key_last
                      00272 key_ready
                      00273 key_lock
                      00274 entry_state
                      00275 in_d1
                      00276 in_d2
                      00277 in_frac
                      00278 
                      00279 uart_new_int
                      00280 uart_new_frac
                      00281 
                      00282 tmp0
                      00283 tmp1
                      00284 tmp2
                      00285 tmp3
                      00286         ENDC
                      00287 
                      00288 ENDIF
                      00005 
                      00006 ; PORTD: segments (a..g,dp) -> RD0..RD7
                      00007 ; PORTC: digit select D1..D4 -> RC0..RC3 (active-high varsay?m?)
                      00008 
02F3                  00009 Display_Service:
                      00010         ; digits off
02F3   1283 1303      00011         BANKSEL PORTC
02F5   1007           00012         BCF     PORTC,0
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02F6   1087           00013         BCF     PORTC,1
02F7   1107           00014         BCF     PORTC,2
02F8   1187           00015         BCF     PORTC,3
                      00016 
                      00017         ; W = disp byte
02F9   1283 1303      00018         BANKSEL disp_idx
02FB   082D           00019         MOVF    disp_idx, W
02FC   2???           00020         CALL    Display_GetByte
                      00021 
02FD   1283 1303      00022         BANKSEL PORTD
02FF   0088           00023         MOVWF   PORTD
                      00024 
                      00025         ; enable digit
0300   1283 1303      00026         BANKSEL disp_idx
0302   082D           00027         MOVF    disp_idx, W
0303   2???           00028         CALL    Display_EnableDigit
                      00029 
                      00030         ; next digit
0304   1283 1303      00031         BANKSEL disp_idx
0306   0AAD           00032         INCF    disp_idx, F
0307   3004           00033         MOVLW   .4
0308   022D           00034         SUBWF   disp_idx, W
0309   1D03           00035         BTFSS   STATUS, Z
030A   0008           00036         RETURN
030B   01AD           00037         CLRF    disp_idx
030C   0008           00038         RETURN
                      00039 
                      00040 
                      00041 ; W=0..3 -> returns disp0..disp3 in W
030D                  00042 Display_GetByte:
030D   00BB           00043         MOVWF   tmp0
030E   08BB           00044         MOVF    tmp0, F
030F   1903           00045         BTFSC   STATUS, Z
0310   2???           00046         GOTO    DGB0
0311   3001           00047         MOVLW   .1
0312   063B           00048         XORWF   tmp0, W
0313   1903           00049         BTFSC   STATUS, Z
0314   2???           00050         GOTO    DGB1
0315   3002           00051         MOVLW   .2
0316   063B           00052         XORWF   tmp0, W
0317   1903           00053         BTFSC   STATUS, Z
0318   2???           00054         GOTO    DGB2
                      00055         ; else 3
0319   2???           00056         GOTO    DGB3
                      00057 
031A                  00058 DGB0:
031A   1283 1303      00059         BANKSEL disp0
031C   082E           00060         MOVF    disp0, W
031D   0008           00061         RETURN
031E                  00062 DGB1:
031E   1283 1303      00063         BANKSEL disp1
0320   082F           00064         MOVF    disp1, W
0321   0008           00065         RETURN
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0322                  00066 DGB2:
0322   1283 1303      00067         BANKSEL disp2
0324   0830           00068         MOVF    disp2, W
0325   0008           00069         RETURN
0326                  00070 DGB3:
0326   1283 1303      00071         BANKSEL disp3
0328   0831           00072         MOVF    disp3, W
0329   0008           00073         RETURN
                      00074 
                      00075 
                      00076 ; W=0..3 -> enable RC0..RC3
032A                  00077 Display_EnableDigit:
032A   00BB           00078         MOVWF   tmp0
032B   08BB           00079         MOVF    tmp0, F
032C   1903           00080         BTFSC   STATUS, Z
032D   2???           00081         GOTO    ED0
032E   3001           00082         MOVLW   .1
032F   063B           00083         XORWF   tmp0, W
0330   1903           00084         BTFSC   STATUS, Z
0331   2???           00085         GOTO    ED1
0332   3002           00086         MOVLW   .2
0333   063B           00087         XORWF   tmp0, W
0334   1903           00088         BTFSC   STATUS, Z
0335   2???           00089         GOTO    ED2
0336   2???           00090         GOTO    ED3
                      00091 
0337                  00092 ED0:
0337   1283 1303      00093         BANKSEL PORTC
0339   1407           00094         BSF     PORTC,0
033A   0008           00095         RETURN
033B                  00096 ED1:
033B   1283 1303      00097         BANKSEL PORTC
033D   1487           00098         BSF     PORTC,1
033E   0008           00099         RETURN
033F                  00100 ED2:
033F   1283 1303      00101         BANKSEL PORTC
0341   1507           00102         BSF     PORTC,2
0342   0008           00103         RETURN
0343                  00104 ED3:
0343   1283 1303      00105         BANKSEL PORTC
0345   1587           00106         BSF     PORTC,3
0346   0008           00107         RETURN
                      00108 
                      00109 
0347                  00110 Display_Rebuild:
0347   1283 1303      00111         BANKSEL error_timer
0349   08AB           00112         MOVF    error_timer, F
034A   1903           00113         BTFSC   STATUS, Z
034B   2???           00114         GOTO    NO_ERROR
                      00115 
                      00116         ; EROR
034C   1283 1303      00117         BANKSEL disp0
034E   3079           00118         MOVLW   0x79        ; E
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

034F   00AE           00119         MOVWF   disp0
0350   3050           00120         MOVLW   0x50        ; r approx
0351   00AF           00121         MOVWF   disp1
0352   303F           00122         MOVLW   0x3F        ; O
0353   00B0           00123         MOVWF   disp2
0354   3050           00124         MOVLW   0x50        ; r
0355   00B1           00125         MOVWF   disp3
0356   0008           00126         RETURN
                      00127 
0357                  00128 NO_ERROR:
0357   1283 1303      00129         BANKSEL disp_mode
0359   082A           00130         MOVF    disp_mode, W
035A   1903           00131         BTFSC   STATUS, Z
035B   2???           00132         GOTO    BUILD_DES
                      00133 
035C   3001           00134         MOVLW   MODE_AMBIENT
035D   022A           00135         SUBWF   disp_mode, W
035E   1903           00136         BTFSC   STATUS, Z
035F   2???           00137         GOTO    BUILD_AMB
                      00138 
0360   2???           00139         GOTO    BUILD_FAN
                      00140 
0361                  00141 BUILD_DES:
0361   2???           00142         CALL    BuildTempDesired
0362   0008           00143         RETURN
0363                  00144 BUILD_AMB:
0363   2???           00145         CALL    BuildTempAmbient
0364   0008           00146         RETURN
0365                  00147 BUILD_FAN:
0365   2???           00148         CALL    BuildFan
0366   0008           00149         RETURN
                      00150 
                      00151 
0367                  00152 BuildTempDesired:
0367   1283 1303      00153         BANKSEL desired_int
0369   0823           00154         MOVF    desired_int, W
036A   2???           00155         CALL    BinTo2Digits
                      00156 
036B   083B           00157         MOVF    tmp0, W
036C   2???           00158         CALL    DigitToSeg
036D   1283 1303      00159         BANKSEL disp0
036F   00AE           00160         MOVWF   disp0
                      00161 
0370   083C           00162         MOVF    tmp1, W
0371   2???           00163         CALL    DigitToSeg
0372   3880           00164         IORLW   0x80               ; dp ON
0373   1283 1303      00165         BANKSEL disp1
0375   00AF           00166         MOVWF   disp1
                      00167 
0376   1283 1303      00168         BANKSEL desired_frac
0378   0824           00169         MOVF    desired_frac, W
0379   2???           00170         CALL    DigitToSeg
037A   1283 1303      00171         BANKSEL disp2
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

037C   00B0           00172         MOVWF   disp2
                      00173 
037D   3039           00174         MOVLW   0x39               ; C
037E   1283 1303      00175         BANKSEL disp3
0380   00B1           00176         MOVWF   disp3
0381   0008           00177         RETURN
                      00178 
                      00179 
0382                  00180 BuildTempAmbient:
0382   1283 1303      00181         BANKSEL ambient_int
0384   0825           00182         MOVF    ambient_int, W
0385   2???           00183         CALL    BinTo2Digits
                      00184 
0386   083B           00185         MOVF    tmp0, W
0387   2???           00186         CALL    DigitToSeg
0388   1283 1303      00187         BANKSEL disp0
038A   00AE           00188         MOVWF   disp0
                      00189 
038B   083C           00190         MOVF    tmp1, W
038C   2???           00191         CALL    DigitToSeg
038D   3880           00192         IORLW   0x80               ; dp ON
038E   1283 1303      00193         BANKSEL disp1
0390   00AF           00194         MOVWF   disp1
                      00195 
0391   1283 1303      00196         BANKSEL ambient_frac
0393   0826           00197         MOVF    ambient_frac, W
0394   2???           00198         CALL    DigitToSeg
0395   1283 1303      00199         BANKSEL disp2
0397   00B0           00200         MOVWF   disp2
                      00201 
0398   3077           00202         MOVLW   0x77               ; A
0399   1283 1303      00203         BANKSEL disp3
039B   00B1           00204         MOVWF   disp3
039C   0008           00205         RETURN
                      00206 
                      00207 
039D                  00208 BuildFan:
039D   1283 1303      00209         BANKSEL fan_rps
039F   0827           00210         MOVF    fan_rps, W
03A0   2???           00211         CALL    BinTo3Digits
                      00212 
03A1   083B           00213         MOVF    tmp0, W
03A2   2???           00214         CALL    DigitToSeg
03A3   1283 1303      00215         BANKSEL disp0
03A5   00AE           00216         MOVWF   disp0
                      00217 
03A6   083C           00218         MOVF    tmp1, W
03A7   2???           00219         CALL    DigitToSeg
03A8   1283 1303      00220         BANKSEL disp1
03AA   00AF           00221         MOVWF   disp1
                      00222 
03AB   083D           00223         MOVF    tmp2, W
03AC   2???           00224         CALL    DigitToSeg
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03AD   1283 1303      00225         BANKSEL disp2
03AF   00B0           00226         MOVWF   disp2
                      00227 
03B0   3071           00228         MOVLW   0x71               ; F
03B1   1283 1303      00229         BANKSEL disp3
03B3   00B1           00230         MOVWF   disp3
03B4   0008           00231         RETURN
                      00232 
                      00233 
                      00234 ; W=0..99 -> tmp0 tens, tmp1 ones
03B5                  00235 BinTo2Digits:
03B5   00BD           00236         MOVWF   tmp2
03B6   01BB           00237         CLRF    tmp0
03B7                  00238 B2_LOOP:
03B7   300A           00239         MOVLW   .10
03B8   023D           00240         SUBWF   tmp2, W
03B9   1C03           00241         BTFSS   STATUS, C
03BA   2???           00242         GOTO    B2_DONE
03BB   300A           00243         MOVLW   .10
03BC   02BD           00244         SUBWF   tmp2, F
03BD   0ABB           00245         INCF    tmp0, F
03BE   2???           00246         GOTO    B2_LOOP
03BF                  00247 B2_DONE:
03BF   083D           00248         MOVF    tmp2, W
03C0   00BC           00249         MOVWF   tmp1
03C1   0008           00250         RETURN
                      00251 
                      00252 
                      00253 ; W=0..255 -> tmp0 hundreds, tmp1 tens, tmp2 ones
03C2                  00254 BinTo3Digits:
03C2   00BE           00255         MOVWF   tmp3
03C3   01BB           00256         CLRF    tmp0
03C4   01BC           00257         CLRF    tmp1
03C5                  00258 B3_H:
03C5   3064           00259         MOVLW   .100
03C6   023E           00260         SUBWF   tmp3, W
03C7   1C03           00261         BTFSS   STATUS, C
03C8   2???           00262         GOTO    B3_T
03C9   3064           00263         MOVLW   .100
03CA   02BE           00264         SUBWF   tmp3, F
03CB   0ABB           00265         INCF    tmp0, F
03CC   2???           00266         GOTO    B3_H
03CD                  00267 B3_T:
03CD   300A           00268         MOVLW   .10
03CE   023E           00269         SUBWF   tmp3, W
03CF   1C03           00270         BTFSS   STATUS, C
03D0   2???           00271         GOTO    B3_DONE
03D1   300A           00272         MOVLW   .10
03D2   02BE           00273         SUBWF   tmp3, F
03D3   0ABC           00274         INCF    tmp1, F
03D4   2???           00275         GOTO    B3_T
03D5                  00276 B3_DONE:
03D5   083E           00277         MOVF    tmp3, W
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03D6   00BD           00278         MOVWF   tmp2
03D7   0008           00279         RETURN
                      00280 
                      00281 
                      00282 ; W=0..9 -> 7seg (Common Cathode)  [NO jump-table]
03D8                  00283 DigitToSeg:
03D8   1283 1303      00284         BANKSEL tmp0
03DA   00BB           00285         MOVWF   tmp0
                      00286 
03DB   08BB           00287         MOVF    tmp0, F
03DC   1903           00288         BTFSC   STATUS, Z
03DD   343F           00289         RETLW   0x3F    ;0
                      00290 
03DE   3001           00291         MOVLW   .1
03DF   063B           00292         XORWF   tmp0, W
03E0   1903           00293         BTFSC   STATUS, Z
03E1   3406           00294         RETLW   0x06    ;1
                      00295 
03E2   3002           00296         MOVLW   .2
03E3   063B           00297         XORWF   tmp0, W
03E4   1903           00298         BTFSC   STATUS, Z
03E5   345B           00299         RETLW   0x5B    ;2
                      00300 
03E6   3003           00301         MOVLW   .3
03E7   063B           00302         XORWF   tmp0, W
03E8   1903           00303         BTFSC   STATUS, Z
03E9   344F           00304         RETLW   0x4F    ;3
                      00305 
03EA   3004           00306         MOVLW   .4
03EB   063B           00307         XORWF   tmp0, W
03EC   1903           00308         BTFSC   STATUS, Z
03ED   3466           00309         RETLW   0x66    ;4
                      00310 
03EE   3005           00311         MOVLW   .5
03EF   063B           00312         XORWF   tmp0, W
03F0   1903           00313         BTFSC   STATUS, Z
03F1   346D           00314         RETLW   0x6D    ;5
                      00315 
03F2   3006           00316         MOVLW   .6
03F3   063B           00317         XORWF   tmp0, W
03F4   1903           00318         BTFSC   STATUS, Z
03F5   347D           00319         RETLW   0x7D    ;6
                      00320 
03F6   3007           00321         MOVLW   .7
03F7   063B           00322         XORWF   tmp0, W
03F8   1903           00323         BTFSC   STATUS, Z
03F9   3407           00324         RETLW   0x07    ;7
                      00325 
03FA   3008           00326         MOVLW   .8
03FB   063B           00327         XORWF   tmp0, W
03FC   1903           00328         BTFSC   STATUS, Z
03FD   347F           00329         RETLW   0x7F    ;8
                      00330 
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

03FE   3009           00331         MOVLW   .9
03FF   063B           00332         XORWF   tmp0, W
0400   1903           00333         BTFSC   STATUS, Z
0401   346F           00334         RETLW   0x6F    ;9
                      00335 
0402   3400           00336         RETLW   0x00    ; invalid -> blank
                      00187         #include "uart.asm"
                      00001 ;========================
                      00002 ; uart.asm
                      00003 ;========================
                      00004         #include "common.inc"
Warning[205]: Found directive in column 1. (IFNDEF)
                      00289 IFNDEF COMMON_INC_LOADED
                      00290 COMMON_INC_LOADED   EQU     1
                      00291 
                      00292         LIST    P=16F877A
                      00293         #include <P16F877A.INC>
                      00294 
                      00295 ;------------ Config (SADECE 1 KERE) ------------
                      00296         __CONFIG _WDT_OFF & _PWRTE_ON & _CP_OFF & _LVP_OFF & _BODEN_OFF & _HS_OSC
                      00297 
                      00298 ;------------ Constants ------------
                      00299 MODE_DESIRED    EQU     0
                      00300 MODE_AMBIENT    EQU     1
                      00301 MODE_FAN        EQU     2
                      00302 
                      00303 NO_KEY          EQU     0xFF
                      00304 
                      00305 ; sys_flags bits
                      00306 F_DO_ADC        EQU     0
                      00307 F_DISP_DIRTY    EQU     1
                      00308 F_UART_GOT_FR   EQU     2
                      00309 F_UART_GOT_IN   EQU     3
                      00310 
                      00311 ; keypad entry_state
                      00312 ENT_IDLE        EQU     0
                      00313 ENT_D1          EQU     1
                      00314 ENT_D2          EQU     2
                      00315 ENT_STAR        EQU     3
                      00316 ENT_FRAC        EQU     4
                      00317 ENT_HASH        EQU     5
                      00318 
                      00319 ;------------ RAM ------------
                      00320         CBLOCK  0x20
                      00321 W_TEMP
                      00322 STATUS_TEMP
                      00323 PCLATH_TEMP
                      00324 
                      00325 desired_int
                      00326 desired_frac
                      00327 ambient_int
                      00328 ambient_frac
                      00329 fan_rps
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00330 
                      00331 tick100ms
                      00332 sec_counter
                      00333 disp_mode
                      00334 error_timer
                      00335 sys_flags
                      00336 
                      00337 disp_idx
                      00338 disp0
                      00339 disp1
                      00340 disp2
                      00341 disp3
                      00342 
                      00343 key_last
                      00344 key_ready
                      00345 key_lock
                      00346 entry_state
                      00347 in_d1
                      00348 in_d2
                      00349 in_frac
                      00350 
                      00351 uart_new_int
                      00352 uart_new_frac
                      00353 
                      00354 tmp0
                      00355 tmp1
                      00356 tmp2
                      00357 tmp3
                      00358         ENDC
                      00359 
                      00360 ENDIF
                      00005 
0403                  00006 UART_Init:
                      00007         ; 9600 @ 4MHz, BRGH=1 => SPBRG=25  (20MHz ise 129)
0403   1683 1303      00008         BANKSEL SPBRG
0405   3019           00009         MOVLW   .25
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0406   0099           00010         MOVWF   SPBRG
                      00011 
0407   1683 1303      00012         BANKSEL TXSTA
0409   3024           00013         MOVLW   b'00100100'     ; BRGH=1, TXEN=1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
040A   0098           00014         MOVWF   TXSTA
                      00015 
040B   1283 1303      00016         BANKSEL RCSTA
040D   3090           00017         MOVLW   b'10010000'     ; SPEN=1, CREN=1
040E   0098           00018         MOVWF   RCSTA
040F   0008           00019         RETURN
                      00020 
0410                  00021 UART_Service:
0410   1283 1303      00022         BANKSEL RCSTA
0412   1898           00023         BTFSC   RCSTA, OERR
0413   2???           00024         GOTO    UART_CLR_OERR
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00025 
0414   1283 1303      00026         BANKSEL PIR1
0416   1E8C           00027         BTFSS   PIR1, RCIF
0417   0008           00028         RETURN
                      00029 
0418   1283 1303      00030         BANKSEL RCREG
041A   081A           00031         MOVF    RCREG, W
041B   2???           00032         CALL    UART_ProcessByte
041C   0008           00033         RETURN
                      00034 
041D                  00035 UART_CLR_OERR:
041D   1283 1303      00036         BANKSEL RCSTA
041F   1218           00037         BCF     RCSTA, CREN
0420   1618           00038         BSF     RCSTA, CREN
0421   0008           00039         RETURN
                      00040 
                      00041 
0422                  00042 UART_ProcessByte:
0422   1283 1303      00043         BANKSEL tmp0
0424   00BB           00044         MOVWF   tmp0
                      00045 
                      00046         ; GET
0425   083B           00047         MOVF    tmp0, W
0426   3A01           00048         XORLW   0x01
0427   1903           00049         BTFSC   STATUS, Z
0428   2???           00050         GOTO    UART_TX_DES_FR
                      00051 
0429   083B           00052         MOVF    tmp0, W
042A   3A02           00053         XORLW   0x02
042B   1903           00054         BTFSC   STATUS, Z
042C   2???           00055         GOTO    UART_TX_DES_IN
                      00056 
042D   083B           00057         MOVF    tmp0, W
042E   3A03           00058         XORLW   0x03
042F   1903           00059         BTFSC   STATUS, Z
0430   2???           00060         GOTO    UART_TX_AMB_FR
                      00061 
0431   083B           00062         MOVF    tmp0, W
0432   3A04           00063         XORLW   0x04
0433   1903           00064         BTFSC   STATUS, Z
0434   2???           00065         GOTO    UART_TX_AMB_IN
                      00066 
0435   083B           00067         MOVF    tmp0, W
0436   3A05           00068         XORLW   0x05
0437   1903           00069         BTFSC   STATUS, Z
0438   2???           00070         GOTO    UART_TX_FAN
                      00071 
                      00072         ; SET? bit7=1
0439   1FBB           00073         BTFSS   tmp0, 7
043A   0008           00074         RETURN
                      00075 
                      00076         ; payload (0..63)
043B   083B           00077         MOVF    tmp0, W
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

043C   393F           00078         ANDLW   b'00111111'
043D   1283 1303      00079         BANKSEL tmp1
043F   00BC           00080         MOVWF   tmp1
                      00081 
                      00082         ; bit6=1 -> INT, bit6=0 -> FRAC
0440   1B3B           00083         BTFSC   tmp0, 6
0441   2???           00084         GOTO    UART_SET_INT
                      00085 
0442                  00086 UART_SET_FRAC:
0442   1283 1303      00087         BANKSEL tmp1
0444   083C           00088         MOVF    tmp1, W
0445   1283 1303      00089         BANKSEL uart_new_frac
0447   00BA           00090         MOVWF   uart_new_frac
                      00091 
0448   1283 1303      00092         BANKSEL sys_flags
044A   152C           00093         BSF     sys_flags, F_UART_GOT_FR
044B   2???           00094         CALL    UART_TRY_COMMIT
044C   0008           00095         RETURN
                      00096 
044D                  00097 UART_SET_INT:
044D   1283 1303      00098         BANKSEL tmp1
044F   083C           00099         MOVF    tmp1, W
0450   1283 1303      00100         BANKSEL uart_new_int
0452   00B9           00101         MOVWF   uart_new_int
                      00102 
0453   1283 1303      00103         BANKSEL sys_flags
0455   15AC           00104         BSF     sys_flags, F_UART_GOT_IN
0456   2???           00105         CALL    UART_TRY_COMMIT
0457   0008           00106         RETURN
                      00107 
                      00108 
0458                  00109 UART_TRY_COMMIT:
0458   1283 1303      00110         BANKSEL sys_flags
045A   1D2C           00111         BTFSS   sys_flags, F_UART_GOT_FR
045B   0008           00112         RETURN
045C   1DAC           00113         BTFSS   sys_flags, F_UART_GOT_IN
045D   0008           00114         RETURN
                      00115 
                      00116         ; consume pair
045E   112C           00117         BCF     sys_flags, F_UART_GOT_FR
045F   11AC           00118         BCF     sys_flags, F_UART_GOT_IN
                      00119 
                      00120         ; frac <= 9 ?
0460   1283 1303      00121         BANKSEL uart_new_frac
0462   300A           00122         MOVLW   .10
0463   023A           00123         SUBWF   uart_new_frac, W
0464   1803           00124         BTFSC   STATUS, C
0465   2???           00125         GOTO    UART_INVALID
                      00126 
                      00127         ; int >= 10 ?
0466   1283 1303      00128         BANKSEL uart_new_int
0468   300A           00129         MOVLW   .10
0469   0239           00130         SUBWF   uart_new_int, W
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

046A   1C03           00131         BTFSS   STATUS, C
046B   2???           00132         GOTO    UART_INVALID
                      00133 
                      00134         ; int < 50 OR (int==50 and frac==0)
046C   3032           00135         MOVLW   .50
046D   0239           00136         SUBWF   uart_new_int, W
046E   1803           00137         BTFSC   STATUS, C
046F   2???           00138         GOTO    UART_CHECK50X
0470   2???           00139         GOTO    UART_ACCEPT
                      00140 
0471                  00141 UART_CHECK50X:
                      00142         ; int > 50 ?
0471   1283 1303      00143         BANKSEL uart_new_int
0473   0839           00144         MOVF    uart_new_int, W
0474   3A32           00145         XORLW   .50
0475   1D03           00146         BTFSS   STATUS, Z
0476   2???           00147         GOTO    UART_INVALID
                      00148 
                      00149         ; int==50 => frac must be 0
0477   1283 1303      00150         BANKSEL uart_new_frac
0479   08BA           00151         MOVF    uart_new_frac, F
047A   1D03           00152         BTFSS   STATUS, Z
047B   2???           00153         GOTO    UART_INVALID
                      00154 
047C                  00155 UART_ACCEPT:
047C   1283 1303      00156         BANKSEL uart_new_int
047E   0839           00157         MOVF    uart_new_int, W
047F   1283 1303      00158         BANKSEL desired_int
0481   00A3           00159         MOVWF   desired_int
                      00160 
0482   1283 1303      00161         BANKSEL uart_new_frac
0484   083A           00162         MOVF    uart_new_frac, W
0485   1283 1303      00163         BANKSEL desired_frac
0487   00A4           00164         MOVWF   desired_frac
                      00165 
0488   1283 1303      00166         BANKSEL sys_flags
048A   14AC           00167         BSF     sys_flags, F_DISP_DIRTY
048B   0008           00168         RETURN
                      00169 
048C                  00170 UART_INVALID:
048C   1283 1303      00171         BANKSEL error_timer
048E   3002           00172         MOVLW   .2
048F   00AB           00173         MOVWF   error_timer
0490   1283 1303      00174         BANKSEL sys_flags
0492   14AC           00175         BSF     sys_flags, F_DISP_DIRTY
0493   0008           00176         RETURN
                      00177 
                      00178 
0494                  00179 UART_SendByte:
0494                  00180 UART_TX_WAIT:
0494   1283 1303      00181         BANKSEL PIR1
0496   1E0C           00182         BTFSS   PIR1, TXIF
0497   2???           00183         GOTO    UART_TX_WAIT
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0498   1283 1303      00184         BANKSEL TXREG
049A   0099           00185         MOVWF   TXREG
049B   0008           00186         RETURN
                      00187 
049C                  00188 UART_TX_DES_FR:
049C   1283 1303      00189         BANKSEL desired_frac
049E   0824           00190         MOVF    desired_frac, W
049F   2???           00191         CALL    UART_SendByte
04A0   0008           00192         RETURN
04A1                  00193 UART_TX_DES_IN:
04A1   1283 1303      00194         BANKSEL desired_int
04A3   0823           00195         MOVF    desired_int, W
04A4   2???           00196         CALL    UART_SendByte
04A5   0008           00197         RETURN
04A6                  00198 UART_TX_AMB_FR:
04A6   1283 1303      00199         BANKSEL ambient_frac
04A8   0826           00200         MOVF    ambient_frac, W
04A9   2???           00201         CALL    UART_SendByte
04AA   0008           00202         RETURN
04AB                  00203 UART_TX_AMB_IN:
04AB   1283 1303      00204         BANKSEL ambient_int
04AD   0825           00205         MOVF    ambient_int, W
04AE   2???           00206         CALL    UART_SendByte
04AF   0008           00207         RETURN
04B0                  00208 UART_TX_FAN:
04B0   1283 1303      00209         BANKSEL fan_rps
04B2   0827           00210         MOVF    fan_rps, W
04B3   2???           00211         CALL    UART_SendByte
04B4   0008           00212         RETURN
                      00188 
3F32                  00189         END
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 38


SYMBOL TABLE
  LABEL                             VALUE 

ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000006
ADCS1                             00000007
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
B2_DONE                           000003BF
B2_LOOP                           000003B7
B3_DONE                           000003D5
B3_H                              000003C5
B3_T                              000003CD
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BRGH                              00000002
BUILD_AMB                         00000363
BUILD_DES                         00000361
BUILD_FAN                         00000365
BinTo2Digits                      000003B5
BinTo3Digits                      000003C2
BuildFan                          0000039D
BuildTempAmbient                  00000382
BuildTempDesired                  00000367
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           0000001D
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 39


SYMBOL TABLE
  LABEL                             VALUE 

CCP2X                             00000005
CCP2Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CCPR2                             0000001B
CCPR2H                            0000001C
CCPR2L                            0000001B
CHS0                              00000003
CHS1                              00000004
CHS2                              00000005
CIS                               00000003
CKE                               00000006
CKP                               00000004
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000009C
CMIE                              00000006
CMIF                              00000006
COMMON_INC_LOADED                 00000001
CREN                              00000004
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            0000009D
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DGB0                              0000031A
DGB1                              0000031E
DGB2                              00000322
DGB3                              00000326
D_A                               00000005
D_NOT_A                           00000005
DigitToSeg                        000003D8
Display_EnableDigit               0000032A
Display_GetByte                   0000030D
Display_Rebuild                   00000347
Display_Service                   000002F3
ED0                               00000337
ED1                               0000033B
ED2                               0000033F
ED3                               00000343
EEADR                             0000010D
EEADRH                            0000010F
EECON1                            0000018C
EECON2                            0000018D
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 40


SYMBOL TABLE
  LABEL                             VALUE 

EEDATA                            0000010C
EEDATH                            0000010E
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
ENT_D1                            00000001
ENT_D2                            00000002
ENT_FRAC                          00000004
ENT_HASH                          00000005
ENT_IDLE                          00000000
ENT_STAR                          00000003
F                                 00000001
FERR                              00000002
FSR                               00000004
F_DISP_DIRTY                      00000001
F_DO_ADC                          00000000
F_UART_GOT_FR                     00000002
F_UART_GOT_IN                     00000003
GCEN                              00000007
GIE                               00000007
GO                                00000002
GO_DONE                           00000002
GO_NOT_DONE                       00000002
I2C_DATA                          00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IRP                               00000007
ISR                               00000004
Init                              0000001A
Keypad_Poll                       00000165
Keypad_Process                    00000231
Keypad_RB_ISR                     0000015E
Keypad_Scan                       00000186
MODE_AMBIENT                      00000001
MODE_DESIRED                      00000000
MODE_FAN                          00000002
MainLoop                          00000061
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BO                            00000000
NOT_BOR                           00000000
NOT_DONE                          00000002
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 41


SYMBOL TABLE
  LABEL                             VALUE 

NOT_RC8                           00000006
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
NO_ERROR                          00000357
NO_KEY                            000000FF
OBF                               00000006
OERR                              00000001
OPTION_REG                        00000081
P                                 00000004
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000002
PCLATH                            0000000A
PCLATH_TEMP                       00000022
PCON                              0000008E
PEIE                              00000006
PEN                               00000002
PIE1                              0000008C
PIE2                              0000008D
PIR1                              0000000C
PIR2                              0000000D
PORTA                             00000005
PORTB                             00000006
PORTC                             00000007
PORTD                             00000008
PORTE                             00000009
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSPIE                             00000007
PSPIF                             00000007
PSPMODE                           00000004
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 42


SYMBOL TABLE
  LABEL                             VALUE 

RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
RD0                               00000000
RD1                               00000001
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
READ_WRITE                        00000002
RP0                               00000005
RP1                               00000006
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
R_NOT_W                           00000002
R_W                               00000002
S                                 00000003
SEN                               00000000
SMP                               00000007
SPBRG                             00000099
SPEN                              00000007
SREN                              00000005
SSPADD                            00000093
SSPBUF                            00000013
SSPCON                            00000014
SSPCON2                           00000091
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 43


SYMBOL TABLE
  LABEL                             VALUE 

SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000094
STATUS                            00000003
STATUS_TEMP                       00000021
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1INSYNC                          00000002
T1OSCEN                           00000003
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 44


SYMBOL TABLE
  LABEL                             VALUE 

TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000087
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000088
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000089
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRMT                              00000001
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
Temp_ControlUpdate                0000013D
Temp_ReadAmbient                  000000BB
Temp_TMR1_ISR                     00000080
Temp_TMR1_Reload                  00000079
UA                                00000001
UART_ACCEPT                       0000047C
UART_CHECK50X                     00000471
UART_CLR_OERR                     0000041D
UART_INVALID                      0000048C
UART_Init                         00000403
UART_ProcessByte                  00000422
UART_SET_FRAC                     00000442
UART_SET_INT                      0000044D
UART_SendByte                     00000494
UART_Service                      00000410
UART_TRY_COMMIT                   00000458
UART_TX_AMB_FR                    000004A6
UART_TX_AMB_IN                    000004AB
UART_TX_DES_FR                    0000049C
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 45


SYMBOL TABLE
  LABEL                             VALUE 

UART_TX_DES_IN                    000004A1
UART_TX_FAN                       000004B0
UART_TX_WAIT                      00000494
W                                 00000000
WCOL                              00000007
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_TEMP                            00000020
Z                                 00000002
_ADD_ACC                          0000012E
_AsciiDigitToBin                  0000029B
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_ALL                           00001FFF
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_CommitDesiredIfValid             000002AE
_DEBUG_OFF                        00003FFF
_DEBUG_ON                         000037FF
_DEVID1                           00002006
_FOSC_EXTRC                       00003FFF
_FOSC_HS                          00003FFE
_FOSC_LP                          00003FFC
_FOSC_XT                          00003FFD
_HS_OSC                           00003FFE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_KeyMap                           000001ED
_LP_OSC                           00003FFC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC                           00003FFF
_ReadRow                          000001BE
_RowMul4                          000001E4
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
_WRT_1FOURTH                      00003BFF
_WRT_256                          00003DFF
_WRT_HALF                         000039FF
_WRT_OFF                          00003FFF
_XT_OSC                           00003FFD
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 46


SYMBOL TABLE
  LABEL                             VALUE 

__16F877A                         00000001
_acq                              000000BF
_bad_digit                        000002AC
_c0                               000001A1
_c1                               000001A5
_c2                               000001AA
_c3                               000001AF
_desired_gt                       00000154
_desired_lt                       00000159
_digit1                           0000025B
_digit2                           00000269
_div10                            00000108
_div_done                         00000120
_expect_hash                      00000290
_expect_star                      00000277
_frac                             00000282
_frac_diff                        00000151
_ge10                             00000113
_int_diff                         0000014E
_kp_accept                        000002D5
_kp_invalid                       000002EB
_kp_rel                           00000182
_mode_ok                          000000B3
_no_adc                           00000072
_no_disp                          00000078
_no_err_dec                       0000009E
_no_key                           0000006B
_pressed                          000001E1
_r0                               000001D4
_r1                               000001D8
_r2                               000001DD
_scan_done                        000001B4
_sec_done                         000000B6
_sh7                              000000FB
_start_entry                      00000251
_wait_adc                         000000C5
ambient_frac                      00000026
ambient_int                       00000025
desired_frac                      00000024
desired_int                       00000023
disp0                             0000002E
disp1                             0000002F
disp2                             00000030
disp3                             00000031
disp_idx                          0000002D
disp_mode                         0000002A
entry_state                       00000035
error_timer                       0000002B
fan_rps                           00000027
in_d1                             00000036
in_d2                             00000037
in_frac                           00000038
key_last                          00000032
MPASM 5.77                          MAIN.ASM   12-27-2025  12:45:39         PAGE 47


SYMBOL TABLE
  LABEL                             VALUE 

key_lock                          00000034
key_ready                         00000033
sec_counter                       00000029
sys_flags                         0000002C
tick100ms                         00000028
tmp0                              0000003B
tmp1                              0000003C
tmp2                              0000003D
tmp3                              0000003E
uart_new_frac                     0000003A
uart_new_int                      00000039

Errors   :     0
Warnings :     6 reported,     0 suppressed
Messages :    11 reported,     0 suppressed

